---
category: record
tags:
  - record
  - seccamp 
date: 2020-05-20
title: セキュリティキャンプ体験談③ 事前課題その１
vssue: false
---

今年のセキュリティキャンプは，オンラインで実施するとの連絡が来ました．  
[参考:セキュリティ・キャンプ全国大会2020　ネクストキャンプ2020について](https://www.ipa.go.jp/jinzai/camp/2020/camp2020_zenkokunext.html#)  
どのように実施するのか，非常に興味があります．  
さて今日は，昨年私がセキュキャンに参加した際に実施した事前課題について紹介しようと思います．

<!-- more -->
# まえがき
前回のセキュリティキャンプに関する記事→
[セキュリティキャンプ体験談② 2〜4日目](https://kojiros.net/posts/2020/05/17/seccamp.html)

セキュリティキャンプに参加するには，事前課題を解き，それを提出する必要があります．  
また，参加の合否は，正答率ではなく，以下に参加意欲があるのかにより決まるらしいです．  
このため，僕はとにかく意欲を見せようと取り組みました．  
ちなみに，応募課題は，志望するトラックごとに異なります．  
今回は，僕が志望した「バラエティトラック」の応募課題の僕の回答を紹介します．

# バラエティトラックの応募課題
以下に，バラエティトラックの応募課題を示します．
```
課題内容を以下に示します．
2019 Cトラック

###
以下の問1と問2はトラックCの必須問題です。問3～問8は選択問題で、3問を選択して回答してください。
###
問1
本問題はシナリオベースの問題です。※登場する組織、プロトコルはすべて架空です。

とあるビルの空調メーカーは自社の制御プロトコルは以下の点から安全であると主張しています。

a.空調のプロトコルは独自であり、公開されていないため、攻撃されることはない。
b.万が一、空調がハッキングされても一時的に寒くなったり、熱くなったりするだけで命にかかわるものではない。
c.仮にエアコンが暴走しても、コンセントを抜けば停止することが可能である。

あなたはプロトコルを調査することにしました。
その結果、たしかに独自ではあったが、暗号化も認証も利用していないことがわかりました。

システム構成
[操作用PC] <--- NW(LAN) ---> [空調制御装置] <--- 独自物理線 ---> [エアコン/室外機]
　↑ここからの送信されたパケットを取得
※NW＝ネットワーク

問a.
以下のバイト列は2019年4月5日に「操作用PC」でキャプチャした通信内容（L7データ）です。
操作した内容とパケットを見比べて、解析を行い、わかったことを述べてください。
ヒント：IEEE 754、リトルエンディアン、CRC、UNIX時間
例）いずれのパケットにも共通する箇所である最初の3バイトはASCIIに直すと「BEG」となっており、「BEGIN」の最初の文字と思われる。
恐らく、パケットの先頭であるということを示していると思われる。

【通信データ】
(1)エアコンの設定温度を28.0度に設定した際のリクエストパケット
42 45 47 08 0A A7 5C 08 00 00 04 00 01 00 00 E0 41 45 4E 44 20 50 A8 F3
(2)エアコンの設定温度を19.5度に設定した際のリクエストパケット
42 45 47 3A 0A A7 5C 08 00 00 04 00 01 00 00 9C 41 45 4E 44 DA 66 22 70
(3)風の強さを5段階の一番強くした際のリクエストパケット
42 45 47 C2 0C A7 5C 05 00 00 04 00 03 05 45 4E 44 06 C7 07 12

問b.
問a.の回答をもとにエアコンの設定温度を30.0度に設定するためのパケットを生成してください。
答えが導き出せなかった場合はわからなかったことを記入してください。

問c.
とある空調メーカーの主張で誤りと感じた部分を指摘してください。

問d.
同システムがハッキング可能であった場合、考えうる最悪のシナリオを書いてください。
例）ビル全体の冷房をガンガン入れて、電気代を高額にする。

###
問2
いままで作ったもの（ソフトウェア、装置、システム、組織、など何でも）で自慢したいものがあれば教えてください．
その中で、何かあなたのプログラミングのスキルを推し量るエピソードがあれば書いてください．

###以下選択問題で、以下から3問選択して回答。
###
問3
あなたは、普段様々なデバイスを用いてインターネットにアクセスしています。その際そのデバイスはどのような通信をしているか想像してください。次に、以下のレポートを読んでください。
https://www.cisco.com/c/ja_jp/solutions/collateral/service-provider/visual-networking-index-vni/white-paper-c11-741490.html

問a．あなたの想像した通信の様相とインターネット全体の通信の様相について、それぞれ記載し、どのような違いがあったか述べてください。また、その理由について考察をまとめて述べてください。
問b．インターネット全体の通信の様相のついて、2023年以降の将来どの様に変化するかあなたの考えを述べてください。

###
問4
今後、人工知能はセキュリティ分野でどのような役割を担うか？あなたの予想と共に、そのメリットとデメリットを記述してください。

###
問5
サイバーセキュリティに関して色んな犯罪がありますが、中にはどういう行為が犯罪なのか分かりにくい条文もまだまだあります。
こういう行為は犯罪に当るのかがよく分からない、これがなぜ犯罪になるのかがよく分からないというのをなるべく具体的に挙げてください。

###
問6
あなたは、何らかのネットワークにつながるコンピュータ装置（いわゆるIoT機器）の脆弱性を調べようとしています。
装置の外部インタフェースとしては、Wi-Fi、USB、Bluetooth、HDMI映像出力が出ており、スイッチやLEDも付いています。
設定はWi-Fiに接続したWebブラウザから行えるようです。内部で動くソフトウェアやOSの種類も分からず、CPUの種類も分かりません。
このとき、装置の外部インタフェースを通じた脆弱性を調べる手順をできるだけ色々と考えてください。なお、装置の蓋を開けて中身を直接調べてたり配線を取り出したりすることも可能とします。

###
問7
ある個人が自分だけで使用しているPC（OSは適当に決めてください）に保存されている情報、例えば特定の文書ファイルやデータなどにしか記録されていないはずの情報が、インターネット上の掲示板に1ヶ月前から掲載されていることを知りました。
この情報がどうやって漏洩したか、PCの状態、さまざまなログやファイル、ルータの通信記録などから推察する手順をできるだけ多くの条件を想定して示してください。

###
問8
CTFでこういう問題を作ってみたい、というのをなるべく具体的に挙げてください。
```

全ての1度に紹介すると，かなり文章が長くなるので，今日は問1に絞って紹介します．

# 問1の回答
では早速，僕の回答を載せます．(拙い文章ですが，ご了承ください.)  
問1は，4つの小問題に分かれてるので，順に説明いたします．  
### 問a.の回答
```
(ア) いずれのパケットも同じ数値である，パケットの後ろから7，6，5バイト目「45 4E 44」をASCIIコードに変換すると「END」となる．  
    これより，この部分は本来送りたいデータの末尾を表すものだと考えられる．  
    
(イ) 通信データ(1)に関して，先頭から4～7バイト目をリトルエンディアンと見立て， UNIX時間に変換すると「2019年4月5日16時55分52秒」となる．  
    これより，この部分はUNIX時間を表していると考えられる．(2)，(3)に関しても同様の結果が得られた．

(ウ) 通信データ(1)に関して，28．0をIEEE754単精度浮動小数点数かつ16進数で表すと，「0x41E00000」となる．  
    これをリトルエンディアンに変換すると「0x0000E041」となる．つまり，通信データ(1)において，14～17バイト目は設定温度を表していると考えられる．  
    通信データ(2)においても同様である．

(エ) 通信データ(3)に関して，先頭から14バイト目が「05」である．  
    この部分は，通信データ(1)，(2)においては温度を表す部分であった．  
    つまり，通信データ(3)においては，風の強さを表すと考えられる．  
    問題文より，通信データ(3)は，風の強さを5段階中の一番強くするとある．  
    つまり5という情報を送ればよいと推測できる．  
    確かに14バイト目で「05」という情報を送っているので，14バイト目が風の強さを表していると考えられる．

(オ) ヒントより，誤り検出方式の1つであるCRCが使用されていると考えられる．  
    また(ア)より，本来送りたいデータは，パケットの先頭の部分「BEG」から，パケットの末尾から5～7バイト目の部分「END」と表される部分までと考えられる．  
    よって，パケット末尾の4バイトが，CRCにおけるエラー検出用のデータと推測できる．また，4バイトは32ビットより，CRCの中でもCRC32であると考えられる．

(カ) 全てのパケットにおいて，8～13バイト目に着目すると，通信データ(1)，(2)は同じであるが，(3)は(1)，(2)と違うことが分かる．  
    このことから，「08 00 00 04 00 01」は温度設定用のパケットであることを，「05 00 00 04 00 03」は風の強さの設定用のパケットであることを示すためのデータであると考えられる．
```

問a.は，ヒントをもとに考えたら，割と簡単に解けるんですよね．  
パケットの怪しい部分を抜き出して，ASCIIコードに変換したり，浮動小数点に直してみたり...と色々試してみると，少しずつ答えが分かっていきます．  
普段からパケット解析を行なっている方からすると簡単だと思いますが，僕はそのようなことはしていないため，結構時間かかりました(丸一日使ったと思います！)  

### 問b.の回答
```
【回答のパケット】42 45 47 E8 16 C1 5C 08 00 00 04 00 01 00 00 F0 41 45 4E 44 ?? ?? ?? ??  

【分からなかったこと】  
問aの回答(エ)において，パケット末尾の4バイトは，CRC32の検査データであると予測を立てた．  
この予測をもとに，文献[1]，[2]を参考にCRC32の検査データを算出するプログラム（以下，プログラム1と呼ぶ）を作成した．  
以下にプログラム1を記す．  
  
1   #include <stdio.h>  
2   #include <inttypes.h>  
3   #include <stdint.h>  
4   
5   uint32_t crcnext(uint32_t crc, uint8_t d, uint32_t magic) {  
6     int i;  
7     for (i = 0; i < 8; i++) {  
8       int b;  
9       if ((d >> i) & 1) crc ^= 1;  
10       b = (crc & 1);  
11       crc >>= 1;  
12       if (b) crc ^= magic;  
13     }  
14     return crc;  
15   }  
16  
17   int main(void) {  
19     uint8_t d[] = "「検査データを算出したいパケット」";  
20     uint32_t crc = UINT32_C(0xFFFFFFFF);  
21     uint32_t magic = UINT32_C(0xEDB88320); /* 反転した生成多項式 */  
22     int i;  
23     for (i = 0; d[i]; i++) {  
24       crc = crcnext(crc, d[i], magic);  
25     }  
26     printf("%08"PRIX32"\n", ~crc);  
27     return 0;  
28   }  
  
インターネット上にCRC32の検査データを算出するツールはいくつか存在したが，私が発見したツールは，全てのデータをASCIIコードで入力しなければならなかった．  
問題のパケットは0x80以上の数値のバイトが存在しているため，0x80以上にも対応するプログラムを作成した．  
文献[1]によると，CRC32を計算する際の生成多項式（マジックナンバ）は「0xEDB88320」などがよく使用されていると分かった．  
そこでまず生成多項式を「0xEDB88320」とし，パケット(1)の検査データをプログラム1で算出した．結果は「0x82B5CC4E」となった．  
これは本来算出されるべき値「0x2050A8F3」とは違う値であった．  
また，ビッグエンディアンでも同じように計算してみたが，全く違う値が算出された．  
この結果と，問題文の一部分「空調のプロトコルは独自であり」から，私は独自の生成多項式を使用しているのではないかと推測を立てた．  
そこで私はプログラム1を改良し，新たにプログラム2を作成した．以下にプログラム2を記す．  
なお，使用するライブラリ，関数crcnextはプログラム1と同じなので省略する．  
  
1   int main(void) {  
2     uint8_t d[] = "「検査データを算出したいパケット」";  
3     uint32_t crc = UINT32_C(0xFFFFFFFF);  
4     uint32_t magic = UINT32_C(0x00000000); /* 生成多項式 */  
5     int loop = 0;  
6     for(loop = 0; loop<0xffffffff; loop++){  
7       int i;  
8       for (i = 0; d[i]; i++) {  
9         crc = crcnext(crc, d[i], magic);   
10      }  
11      if (~crc == 0xF3A85020){  
12       printf("%08"PRIX32"\n", magic);  
13        return 0;  
14      }  
15      magic++;  
16    }  
17    return 0;  
18  }  
  
プログラム2は，0x00000000から0xffffffffまでの全ての32ビットの生成多項式で検査データを算出し，特定の検査データ（パケット(1)の場合，0x2050A8F3）が出力されると，その生成多項式が求めたい生成多項式であると標準出力する．  
これにより，正しい生成多項式が算出できると考えたが，一つもヒットしなかった．  
原因としては，そもそもCRC32ではない，またプログラム2が間違っているなどが考えられるが，最終的には原因が分からなかった．  
よって，本問題の回答の末尾4バイトは「?? ?? ?? ??」としている．  
```

今改めてみると，酷いプログラムだと思います．  
僕のマシンだと，0x00000000から-xffffffffまでの全ての生成多項式で検査データを算出するには，大体半日くらいかかりました．  
いくら計算時間を問う問題では無いからと言って，こんな遅いプログラムを作っているようではダメですね．反省します．

### 問c.の回答
```
①	主張aに関して，「公開されていないため，攻撃されることはない」という主張が誤りだと感じた．  
    私は以下の攻撃が行われる可能性があると考える．  
      (ア) 盗聴  
            送信されるメッセージに暗号化を施していないため，メッセージを盗み取られたときに容易に内容を解読されるため，中間者攻撃などの攻撃ができる．  
      (イ) 不正アクセス  
            認証を行っていないため，部外者でも空調制御装置をコントロールすることができる．  
　　また，内部者が知らないうちに外部に情報を漏らしてしまう可能性もある．公開していないことが攻撃からの防御になるという考えは，非常に危険な考えである．  

②	主張bに関して，「命にかかわるものではない」という主張が誤りだとを感じた．  
    理由として，それはあくまで主張する人からの目線であり，温度の変化に極端に弱い人からすると，重大な問題となりうるからである．
    例えば，病院の空調がハッキングされた場合，体の弱い方にとっては命にかかわるものである．  

③	主張bに関して，「ハッキングされても一時的に寒くなったり，熱くなったりするだけ」という部分が誤りだと感じた．
    空調の機能には，もちろん空調の種類によるが，温度調整だけでなく，風の強さ，湿度，風の向きなども含まれる．  

④	主張cに関して，「コンセントを抜けば停止することが可能である」という部分が誤りだと感じた．空調のコンプレッサーには，基本的に潤滑油が使われている．  
    この潤滑油は常に高温を保っておく必要があり，そのためエアコンはコンセントを常に刺しておく必要がある．  
    一時的に抜くことは可能だが，攻撃への対処を行う間ずっとコンセントを抜いておくのはエアコンの故障に繋がる．よって，コンセントを抜くという対処は不適切である．  
    また，空調は基本的に高い位置に備える．そのためコンセントも高い位置に刺すのが普通である．そのため必ずしもコンセントをすぐに抜けるとは限らない．  
```

これに関しては，今見るとかなり無理やり感を感じますね．  
とりあえず，数を増やすために思いついたことを書き殴った感じがします．  
ただ，パッションは伝わったのかな?と思います．

### 問d.の回答
```
以下を前提とする．
  I.	とあるビルの空調メーカーは，日本に存在する空調システム全てを管理しているとする．
  II.	攻撃者は空調システムの管理者に気付かれないように，日本にある全ての空調にハッキングしておく．
  III.	攻撃が行われる時間は，発電所が電気の出力を下げている真夜中の時間とする．

攻撃者は日本にある全ての空調の設定温度を，一斉に可能な限り低くする．  
これにより，発電所が許容できる発電量を超えてしまい，発電所はオーバーヒートし，日本全体を停電させることができる．  
この状況で考えられる最悪のシナリオとして，病院への電力供給を断つことができる．予備電力はあるだろうが，それも時間の問題である．  
NICUなどの電気が常に必要な治療室では，多くの人が亡くなることが予想される．  
人の命より重いものはないので，これが最悪のシナリオであるといえる．
```

僕が思うに，人の命より重いものは無いです．  
このため，最悪のシナリオとして，人の命を奪ってしまうことを考えました．  
僕の中では，このシナリオは最悪に近いものだと思うのですが，他にいいアイデアがある方は，ぜひ教えていただけたら嬉しいです！

# おわりに
セキュキャンの応募課題について，一部僕の回答を紹介した．  
今年はオンラインでセキュキャンを行うそうですが，応募課題は例年通り行うのでしょうか...(オンラインなら人数制限そこまで必要ないのでは?なら選考必要ないのでは?)  
いずれにせよ，応募課題が発表されたなら，また解いてみたいですね．